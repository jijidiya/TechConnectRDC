<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Boutique - Ordinateurs portables</title>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f1724;
      --muted:#6b7280;
      --primary:#83759e;
      --accent:#a100ff;
      --border:#e6e9f0;
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header{
      background:var(--card);
      border-bottom:1px solid var(--border);
      position:sticky; top:0; z-index:20;
    }
    .nav{
      max-width:1200px; margin:auto; padding:14px 20px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand{font-weight:700; letter-spacing:.4px}
    .nav-actions{display:flex; gap:10px; align-items:center}
    .btn{
      padding:9px 14px; border-radius:10px; border:1px solid var(--border);
      background:#fff; cursor:pointer; font-weight:600; color:var(--text);
    }
    .btn.primary{
      background:linear-gradient(90deg,var(--primary),var(--accent));
      color:#fff; border:none;
    }
    .container{max-width:1200px; margin:auto; padding:28px 20px}
    .product-hero{
      display:grid; grid-template-columns: 1.2fr 1fr; gap:28px; align-items:start;
    }
    .media{
      background:linear-gradient(180deg,#eef2ff,#f8fafc);
      border-radius:var(--radius); padding:18px; min-height:420px;
      display:flex; flex-direction:column; gap:12px;
    }
    .media-main{
      flex:1; border-radius:10px; background:#fff; border:1px solid var(--border);
      display:flex; align-items:center; justify-content:center; overflow:hidden;
    }
    .media-main img{max-width:100%; max-height:100%; object-fit:contain; display:block}
    .thumbs{display:flex; gap:10px; margin-top:6px}
    .thumb{width:84px; height:64px; border-radius:8px; overflow:hidden; border:1px solid var(--border); background:#fff; display:flex; align-items:center; justify-content:center}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:20px;
    }
    .title{font-size:22px; margin:0 0 6px}
    .price{font-size:20px; font-weight:700; color:#0b1220; margin-bottom:8px}
    .muted{color:var(--muted); font-size:14px}
    .specs{margin-top:12px; display:grid; gap:8px}
    .spec{display:flex; justify-content:space-between; padding:8px 10px; border-radius:10px; background:#fbfbff; border:1px solid #f0f2fb}
    .row{display:flex; gap:12px; align-items:center; margin-top:14px}
    input[type="number"]{padding:10px; border-radius:10px; border:1px solid var(--border); width:110px}
    .actions{display:flex; gap:12px; margin-top:16px}
    .feedback{margin-top:10px; color:green; font-weight:600}
    .section-title{margin:34px 0 12px; font-weight:700}
    .grid{
      display:grid; gap:18px;
      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
    }
    .product-card{
      background:var(--card); border:1px solid var(--border); border-radius:12px; overflow:hidden;
      cursor:pointer; transition:transform .18s ease, box-shadow .18s ease;
    }
    .product-card:hover{transform:translateY(-6px); box-shadow:0 12px 30px rgba(16,24,40,.08)}
    .product-thumb{height:140px; background:#f3f6ff; display:flex; align-items:center; justify-content:center; overflow:hidden}
    .product-thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .product-body{padding:12px}
    .product-name{font-weight:700; font-size:15px; margin-bottom:6px}
    .product-meta{display:flex; justify-content:space-between; color:var(--muted); font-size:13px}
    @media (max-width:980px){ .product-hero{grid-template-columns:1fr} }
    @media (max-width:520px){ .thumb{width:64px; height:48px} .product-thumb{height:120px} }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">Laptops</div>
      <div class="nav-actions">
        <button class="btn" onclick="location.href='Panier.html'">Voir le panier</button>
        <button class="btn primary" onclick="location.href='Panier.html'">Commander</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="product-hero">
      <div class="media card">
        <div class="media-main" id="hero-media">
          <img id="hero-main-img" src="" alt="Image produit" />
        </div>
        <div class="thumbs" id="hero-thumbs"></div>
      </div>

      <aside class="card">
        <h1 class="title" id="hero-title">Sélectionnez un ordinateur</h1>
        <div class="price" id="hero-price">$0.00</div>
        <div class="muted" id="hero-desc">Cliquez sur un modèle ci-dessous pour afficher ses détails.</div>

        <div class="specs" id="hero-specs" aria-live="polite"></div>

        <div class="row">
          <div style="flex:1">
            <label class="muted">Quantité</label>
            <input type="number" id="hero-qty" min="1" value="1" />
          </div>
          <div style="width:160px">
            <label class="muted">Garantie</label>
            <select id="hero-warranty" style="width:100%; padding:10px; border-radius:10px; border:1px solid var(--border)">
              <option value="1">1 an (standard)</option>
              <option value="2">2 ans (+$79)</option>
              <option value="3">3 ans (+$129)</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="add-btn">Ajouter au panier</button>
          <button class="btn" onclick="location.href='cart.html'">Aller au panier</button>
        </div>

        <div class="feedback" id="hero-feedback" aria-live="polite"></div>
      </aside>
    </section>

    <h2 class="section-title">Nos modèles populaires</h2>
    <div class="grid" id="catalog"></div>
  </main>

  <script>
    const laptops = [
      {
        id: "macbook-air-m3",
        name: "Apple MacBook Air M3 (13\")",
        price: 1199.00,
        desc: "Puce Apple M3, écran 13.6\" Liquid Retina, 8–24 Go RAM, SSD 256–2 To. Ultra‑léger et autonome.",
        specs: [
          "Processeur: Apple M3",
          "Écran: 13.6\" Liquid Retina",
          "RAM: 8 / 16 / 24 Go",
          "Stockage: 256 Go – 2 To SSD",
          "Poids: ~1.24 kg"
        ],
        images: [
          "Images/Image1.jpg",
          "Images/Image11.jpg",
          "Images/Image12.jpg",
          "Images/Image13.jpg"
        ]
      },
      {
        id: "dell-xps-13",
        name: "Dell XPS 13 Plus (2024)",
        price: 1399.00,
        desc: "Ultrabook premium, écran 13.4\" OLED optionnel, processeurs Intel Core Ultra, finition aluminium.",
        specs: [
          "Processeur: Intel Core Ultra / Core i7",
          "Écran: 13.4\" OLED / FHD+",
          "RAM: 16–32 Go",
          "Stockage: 512 Go – 2 To SSD",
          "Poids: ~1.2 kg"
        ],
        images: [
          "Images/Image2.jpg",
          "Images/Image21.jpg",
          "Images/Image22.jpg",
          "Images/Image23.jpg"
        ]
      },
      {
        id: "hp-spectre-x360",
        name: "HP Spectre x360 14 (2024)",
        price: 1499.00,
        desc: "Convertible 2‑en‑1, écran OLED 2.8K 120Hz, stylet, châssis premium et autonomie solide.",
        specs: [
          "Processeur: Intel Core i7",
          "Écran: 13.5\" / 14\" OLED 2.8K",
          "RAM: 16 Go",
          "Stockage: 512 Go – 1 To SSD",
          "Fonction: Convertible tactile"
        ],
        images: [
          "Images/Image3.jpg",
          "Images/Image31.jpg",
          "Images/Image32.jpg",
          "Images/Image33.jpg"
        ]
      },
      {
        id: "lenovo-thinkpad-x1",
        name: "Lenovo ThinkPad X1 Carbon Gen 12",
        price: 1599.00,
        desc: "Ultrabook professionnel, châssis carbone, clavier signature ThinkPad, sécurité et robustesse.",
        specs: [
          "Processeur: Intel Core Ultra / i7",
          "Écran: 14\" 2.8K / FHD",
          "RAM: 16–32 Go",
          "Stockage: 512 Go – 2 To SSD",
          "Sécurité: TPM, lecteur d'empreinte"
        ],
        images: [
          "Images/Image4.jpg",
          "Images/Image41.jpg",
          "Images/Image42.jpg",
          "Images/Image43.jpg"
        ]
      },
      {
        id: "asus-rog-zephyrus",
        name: "ASUS ROG Zephyrus G14 (2024)",
        price: 1799.00,
        desc: "Portable gaming 14\", Ryzen / Intel, GPU RTX, écran 120–165Hz, refroidissement performant.",
        specs: [
          "Processeur: AMD Ryzen 9 / Intel",
          "GPU: NVIDIA RTX 40‑series",
          "Écran: 14\" 120–165Hz",
          "RAM: 16–32 Go",
          "Stockage: 1 To SSD"
        ],
        images: [
          "Images/Image5.jpg",
          "Images/Image51.jpg",
          "Images/Image52.jpg",
          "Images/Image53.jpg"
        ]
      }
    ];

    let selected = null;

    function escapeHtml(str){
      if(!str) return '';
      return String(str).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
    }

    function renderCatalog(){
      const grid = document.getElementById("catalog");
      grid.innerHTML = "";
      laptops.forEach((p, idx) => {
        const card = document.createElement("article");
        card.className = "product-card";
        card.setAttribute("data-id", p.id);
        card.innerHTML = `
          <div class="product-thumb">
            <img src="${p.images[0]}" alt="${escapeHtml(p.name)}" loading="lazy" onerror="this.style.opacity=.6; this.style.objectFit='contain';" />
          </div>
          <div class="product-body">
            <div class="product-name">${escapeHtml(p.name)}</div>
            <div class="product-meta">
              <span>$${p.price.toFixed(2)}</span>
              <span class="muted">Modèle réel</span>
            </div>
          </div>
        `;
        card.addEventListener("click", () => selectProduct(idx, true));
        grid.appendChild(card);
      });
    }

    function selectProduct(index, focus = false){
      const p = laptops[index];
      selected = p;
      document.getElementById("hero-title").textContent = p.name;
      document.getElementById("hero-price").textContent = `$${p.price.toFixed(2)}`;
      document.getElementById("hero-desc").textContent = p.desc;
      const mainImg = document.getElementById("hero-main-img");
      mainImg.src = p.images[0];
      mainImg.alt = p.name;
      const thumbs = document.getElementById("hero-thumbs");
      thumbs.innerHTML = "";
      p.images.forEach((src, i) => {
        const t = document.createElement("div");
        t.className = "thumb";
        t.innerHTML = `<img src="${src}" alt="${escapeHtml(p.name)} vue ${i+1}" loading="lazy" onerror="this.style.opacity=.6; this.style.objectFit='contain';" />`;
        t.addEventListener("click", () => { mainImg.src = src; });
        thumbs.appendChild(t);
      });
      const specsEl = document.getElementById("hero-specs");
      specsEl.innerHTML = "";
      p.specs.forEach(s => {
        const div = document.createElement("div");
        div.className = "spec";
        div.innerHTML = `<div class="muted">${escapeHtml(s)}</div><div style="font-weight:700;color:#0b1220"></div>`;
        specsEl.appendChild(div);
      });
      document.getElementById("hero-feedback").textContent = "Modèle sélectionné. Choisissez la quantité et ajoutez au panier.";
      document.getElementById("hero-qty").value = 1;
      if(focus){
        setTimeout(()=> {
          document.querySelector('.product-hero').scrollIntoView({behavior:'smooth', block:'start'});
        }, 80);
      }
      try { localStorage.removeItem('lastSelectedProduct'); } catch(e){}
    }

    function addToCart(){
      if(!selected){
        document.getElementById("hero-feedback").textContent = "Veuillez sélectionner un modèle dans le catalogue.";
        return;
      }
      const qty = Math.max(1, parseInt(document.getElementById("hero-qty").value || "1", 10));
      const warranty = parseInt(document.getElementById("hero-warranty").value, 10);
      let warrantyPrice = 0;
      if(warranty === 2) warrantyPrice = 79;
      if(warranty === 3) warrantyPrice = 129;
      const item = {
        id: selected.id,
        name: selected.name,
        price: selected.price,
        quantity: qty,
        warrantyYears: warranty,
        warrantyPrice: warrantyPrice,
        image: selected.images[0]
      };
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const existing = cart.find(i => i.id === item.id && i.warrantyYears === item.warrantyYears);
      if(existing){ existing.quantity += item.quantity; } else { cart.push(item); }
      localStorage.setItem("cart", JSON.stringify(cart));
      document.getElementById("hero-feedback").textContent = "Produit ajouté au panier ✔";
      flashButton("#add-btn");
    }

    function flashButton(selector){
      const btn = document.querySelector(selector);
      if(!btn) return;
      const original = btn.style.transform;
      btn.style.transform = "scale(0.98)";
      setTimeout(()=> btn.style.transform = original, 120);
    }

    // Pré-sélection depuis Panier.html si lastSelectedProduct est défini
    function preselectFromStorage(){
      try {
        const id = localStorage.getItem('lastSelectedProduct');
        if(!id) return false;
        const idx = laptops.findIndex(p => p.id === id);
        if(idx >= 0){
          selectProduct(idx, true);
          return true;
        }
      } catch(e){}
      return false;
    }

    // Initialisation
    document.getElementById("add-btn").addEventListener("click", addToCart);
    renderCatalog();
    const pre = preselectFromStorage();
    if(!pre) selectProduct(0);
  </script>
</body>
</html>